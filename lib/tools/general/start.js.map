{"version":3,"sources":["../../../src/tools/general/start.js"],"names":["start","webpackConfig","then","serverConfig","plugins","push","log","bundler","wpMiddleware","hotMiddleware","compilers","handleBundleComplete","stats","compilation","errors","length","target","bs","create","init","notify","ui","proxy","middleware","proxyOptions","xfwd","plugin","error","console","server","listen"],"mappings":";;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;AAQA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,SAASA,KAAT,CAAgBC,aAAhB,EAA+B;AAC7B;;AAEA,uCAAkB;AAChB,wCACCC,IADD,CACM,MAAM,kCADZ,EAECA,IAFD,CAEM,MAAM;AAAA,0CACeD,aADf;;AAAA,YACDE,YADC;;AAGV;AACA;;AACAA,mBAAaC,OAAb,CAAqBC,IAArB,CAA0B,qCAAoB,EAACC,+BAAD,EAApB,CAA1B;;AAEA,YAAMC,UAAU,uBAAQN,aAAR,CAAhB;AACA,YAAMO,eAAe,oCAAqBD,OAArB,6BAArB;AACA,YAAME,gBAAgB,oCAAqBF,QAAQG,SAAR,CAAkB,CAAlB,CAArB,6BAAtB;;AAEA,UAAIC,uBAAuB,MAAM;AAC/BA,+BAAuBC,SAAS,CAACA,MAAMA,KAAN,CAAY,CAAZ,EAAeC,WAAf,CAA2BC,MAA3B,CAAkCC,MAAnC,IAA6C,0BAA7E;;AAEA,cAAMC,SAAU,GAAD,uBAAQ,IAAR,uBAAgB,EAA/B;;AAEA,iCAAUA,MAAV,EAAkBd,IAAlB,CAAuB,MAAM;AAC3B,gBAAMe,KAAK,sBAAYC,MAAZ,EAAX;;AAEAD,aAAGE,IAAH,cACK,mCAAgB,EAAhB,GAAqB,EAACC,kCAAD,EAAkBC,8BAAlB,EAD1B;;AAGEC,mBAAO;AACLN,oBADK;AAELO,0BAAY,CAAC,4BAAD,EAAaf,YAAb,EAA2BC,aAA3B,CAFP;AAGLe,4BAAc;AACZC,sBAAM;AADM;AAHT;AAHT;AAWD,SAdD;AAeD,OApBD;;AAsBAlB,cAAQmB,MAAR,CAAe,MAAf,EAAuBd,SAASD,qBAAqBC,KAArB,CAAhC;AACD,KApCD,EAoCIe,KAAD,IAAW;AACZC,cAAQD,KAAR,CAAcA,KAAd;AACD,KAtCD;AAuCD,GAxCD,MAwCO;AACL,UAAME,SAAS,+BAAQ,uBAAQ5B,aAAR,CAAR,6BAAf;;AAEA4B,WAAOC,MAAP,mDAA0B,MAAMF,QAAQtB,GAAR,CAAa,eAAD,yBAAsB,EAAlC,CAAhC;AACD;AACF;;kBAEcN,K","file":"start.js","sourcesContent":["import browserSync from 'browser-sync';\nimport compress from 'compression';\nimport webpack from 'webpack';\nimport webpackDevMiddleware from 'webpack-dev-middleware';\nimport WDS from 'webpack-dev-server';\nimport webpackHotMiddleware from 'webpack-hot-middleware';\nimport WriteFilePlugin from 'write-file-webpack-plugin';\nimport {\n  host,\n  isDebug,\n  isDevelopment,\n  isIsomorphic,\n  port,\n  socket,\n} from '../../configs/prepare.build-tools.config';\nimport prepareTypescriptConfig from '../../configs/prepareTypescriptConfig';\nimport runServer from '../../configs/utils/runServer';\nimport webpackDevServerConfig from '../../configs/webpack/webpack.devserver.config';\nimport run from '../run';\nimport clean from './clean';\nimport copy from './copy';\n\nfunction start (webpackConfig) {\n  prepareTypescriptConfig();\n\n  if (isIsomorphic) {\n    run(clean)\n    .then(() => run(copy))\n    .then(() => {\n      const [, serverConfig] = webpackConfig;\n\n      // Save the server-side bundle files to the file system after compilation\n      // https://github.com/webpack/webpack-dev-server/issues/62\n      serverConfig.plugins.push(new WriteFilePlugin({log: isDebug}));\n\n      const bundler = webpack(webpackConfig);\n      const wpMiddleware = webpackDevMiddleware(bundler, webpackDevServerConfig);\n      const hotMiddleware = webpackHotMiddleware(bundler.compilers[0], webpackDevServerConfig);\n\n      let handleBundleComplete = () => {\n        handleBundleComplete = stats => !stats.stats[1].compilation.errors.length && runServer();\n\n        const target = `${host}:${port}`;\n\n        runServer(target).then(() => {\n          const bs = browserSync.create();\n\n          bs.init({\n            ...isDevelopment ? {} : {notify: isDebug, ui: isDebug},\n\n            proxy: {\n              target,\n              middleware: [compress(), wpMiddleware, hotMiddleware],\n              proxyOptions: {\n                xfwd: true,\n              },\n            },\n          });\n        });\n      };\n\n      bundler.plugin('done', stats => handleBundleComplete(stats));\n    }, (error) => {\n      console.error(error);\n    });\n  } else {\n    const server = new WDS(webpack(webpackConfig), webpackDevServerConfig);\n\n    server.listen(port, host, () => console.log(`Launched on ${socket}`));\n  }\n}\n\nexport default start;\n"]}